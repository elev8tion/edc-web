# Web Push Notification Worker Configuration
# Deploy with: wrangler deploy -c wrangler-webpush.toml

name = "edc-web-push"
main = "src/web-push.js"
compatibility_date = "2024-01-01"

# Enable workers.dev subdomain
workers_dev = true

# KV Namespace for storing push subscriptions and preferences
# Create with: wrangler kv:namespace create PUSH_SUBSCRIPTIONS
# Then add the id below
[[kv_namespaces]]
binding = "PUSH_SUBSCRIPTIONS"
id = "76081a3cb8634b4aa348aeeb31bbb4f7"

# Scheduled trigger for timezone-aware notifications
# Runs every hour to check user preferences and send notifications at their local time
[triggers]
crons = ["0 * * * *"]

# Environment variables
[vars]
VAPID_SUBJECT = "mailto:support@everydaychristian.app"

# Secrets (set via: wrangler secret put SECRET_NAME -c wrangler-webpush.toml)
# Required secrets:
# - VAPID_PUBLIC_KEY: Base64URL encoded public key
# - VAPID_PRIVATE_KEY: Base64URL encoded private key
# - NOCODEBACKEND_API_KEY: API key for NoCodeBackend (Instance: 36905_activation_codes)
#
# Set NOCODEBACKEND_API_KEY:
#   wrangler secret put NOCODEBACKEND_API_KEY -c wrangler-webpush.toml
#
# Generate VAPID keys with:
#   npx web-push generate-vapid-keys
#
# Or use OpenSSL:
#   openssl ecparam -name prime256v1 -genkey -noout -out vapid_private.pem
#   openssl ec -in vapid_private.pem -pubout -out vapid_public.pem
#   openssl ec -in vapid_private.pem -outform DER | tail -c 32 | base64 | tr '/+' '_-' | tr -d '='
