# Auth Service Worker Configuration
# Deploy with: wrangler deploy -c wrangler-auth.toml

name = "auth-service"
main = "src/auth-service.js"
compatibility_date = "2024-01-01"

# Enable workers.dev subdomain (required for CNAME from external DNS)
workers_dev = true

# Custom domain is handled via Netlify DNS CNAME pointing to workers.dev
# auth.everydaychristian.app -> auth-service.connect-2a2.workers.dev

# Environment variables
[vars]
NOCODEBACKEND_API_URL = "https://api.nocodebackend.com"
NOCODEBACKEND_INSTANCE = "36905_activation_codes"
# JWT expires in 7 days (in seconds)
JWT_EXPIRES_IN = "604800"
# Token expiry for reset/verification (24 hours in seconds)
TOKEN_EXPIRES_IN = "86400"
# App URLs for email links
APP_URL_WEB = "https://app.everydaychristian.app"
APP_URL_MOBILE = "everydaychristian://"
# Security: Environment and token configuration
ENVIRONMENT = "production"
# PBKDF2 iterations (OWASP 2024 recommendation: 600000)
PBKDF2_ITERATIONS = "600000"
# Access token expiry in seconds (15 minutes)
ACCESS_TOKEN_EXPIRY = "900"
# Refresh token expiry in seconds (7 days)
REFRESH_TOKEN_EXPIRY = "604800"

# KV Namespace for token blacklist (persistent across worker instances)
[[kv_namespaces]]
binding = "TOKEN_BLACKLIST"
id = "cd860eda70c64159bb49c456423e7a6b"

# Secrets (set via: wrangler secret put SECRET_NAME -c wrangler-auth.toml)
# Required secrets:
# - NOCODEBACKEND_API_KEY: API key for NoCodeBackend
# - JWT_SECRET: Secret for signing JWT tokens (generate with: openssl rand -hex 32)
# - EMAILIT_API_KEY: API key for EmailIt email service
