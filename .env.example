# ============================================================================
# Everyday Christian - Environment Variables Template
# ============================================================================
#
# SECURITY INSTRUCTIONS:
# 1. Copy this file: cp .env.example .env
# 2. Fill in ACTUAL values in .env (NEVER commit .env to git!)
# 3. Use different keys for development/staging/production
# 4. Rotate all keys every 90 days
# 5. Monitor for exposed keys: https://github.com/settings/security-analysis
#
# For detailed security guide, see: STRIPE_SECURITY_BEST_PRACTICES.md
# ============================================================================

# ============================================================================
# ENVIRONMENT CONFIGURATION
# ============================================================================
# SECURITY: Set this to prevent accidental production key usage in dev
APP_ENV=development  # Options: development, staging, production

# Key Rotation Tracking (Update these dates when rotating keys)
LAST_KEY_ROTATION_DATE=2025-01-23
NEXT_KEY_ROTATION_DATE=2025-04-23

# ============================================================================
# Google Gemini API Key Pool - 20-Key Rotation System
# ============================================================================
#
# SECURITY REQUIREMENTS:
# 1. Apply bundle ID restrictions: com.everydaychristian.app
# 2. Set API restrictions: Generative Language API ONLY
# 3. Enable billing alerts: $50 warning, $100 hard cap per key
# 4. Use different keys for dev/staging/production
# 5. Never log or expose these keys in error messages
#
# ROTATION SCHEDULE: Every 90 days
# ============================================================================

# API Key Pool (Priority: Used first if available)
GEMINI_API_KEY_1=your_api_key_1_here
GEMINI_API_KEY_2=your_api_key_2_here
GEMINI_API_KEY_3=your_api_key_3_here
GEMINI_API_KEY_4=your_api_key_4_here
GEMINI_API_KEY_5=your_api_key_5_here
GEMINI_API_KEY_6=your_api_key_6_here
GEMINI_API_KEY_7=your_api_key_7_here
GEMINI_API_KEY_8=your_api_key_8_here
GEMINI_API_KEY_9=your_api_key_9_here
GEMINI_API_KEY_10=your_api_key_10_here
GEMINI_API_KEY_11=your_api_key_11_here
GEMINI_API_KEY_12=your_api_key_12_here
GEMINI_API_KEY_13=your_api_key_13_here
GEMINI_API_KEY_14=your_api_key_14_here
GEMINI_API_KEY_15=your_api_key_15_here
GEMINI_API_KEY_16=your_api_key_16_here
GEMINI_API_KEY_17=your_api_key_17_here
GEMINI_API_KEY_18=your_api_key_18_here
GEMINI_API_KEY_19=your_api_key_19_here
GEMINI_API_KEY_20=your_api_key_20_here

# Fallback API Key
GEMINI_API_KEY=your_api_key_here

# ============================================================================
# STRIPE CONFIGURATION
# ============================================================================
#
# SECURITY REQUIREMENTS:
# 1. Use RESTRICTED keys (rk_test_* or rk_live_*), NOT secret keys (sk_*)
# 2. Grant MINIMUM permissions needed:
#    - Products: Read + Write
#    - Prices: Read + Write
#    - Customers: Read + Write
#    - Subscriptions: Read + Write
#    - Payment Links: Read + Write
# 3. NEVER expose secret/restricted keys in client-side code
# 4. ALWAYS verify webhook signatures
# 5. Use test mode (rk_test_*) for development
# 6. Rotate keys every 90 days
#
# CREATE RESTRICTED KEY:
# https://dashboard.stripe.com/test/apikeys (Test Mode)
# https://dashboard.stripe.com/apikeys (Production Mode)
#
# ROTATION SCHEDULE: Every 90 days
# ============================================================================

# Stripe Restricted API Key (BACKEND ONLY - Never expose to client!)
# Development: Use rk_test_* keys OR sk_test_* for testing
# Production: Use rk_live_* keys ONLY
STRIPE_RESTRICTED_KEY=rk_test_YOUR_RESTRICTED_KEY_HERE

# Stripe Publishable Key (Safe for client-side use)
# Development: Use pk_test_* keys
# Production: Use pk_live_* keys
STRIPE_PUBLISHABLE_KEY=pk_test_YOUR_PUBLISHABLE_KEY_HERE

# Webhook Signing Secret (CRITICAL - Used to verify webhook authenticity)
# Get this from: Developers → Webhooks → [Your Endpoint] → Signing secret
# Development: Use whsec_test_* keys
# Production: Use whsec_* keys
STRIPE_WEBHOOK_SECRET=whsec_YOUR_WEBHOOK_SECRET_HERE

# Stripe Product & Price IDs (Safe to expose - they're public references)
STRIPE_PRODUCT_MONTHLY_ID=prod_YOUR_MONTHLY_PRODUCT_ID
STRIPE_PRODUCT_YEARLY_ID=prod_YOUR_YEARLY_PRODUCT_ID
STRIPE_PRICE_MONTHLY_ID=price_YOUR_MONTHLY_PRICE_ID
STRIPE_PRICE_YEARLY_ID=price_YOUR_YEARLY_PRICE_ID

# Payment Links (Safe to expose - they're public URLs)
STRIPE_PAYMENT_LINK_MONTHLY=https://buy.stripe.com/test_YOUR_MONTHLY_LINK
STRIPE_PAYMENT_LINK_YEARLY=https://buy.stripe.com/test_YOUR_YEARLY_LINK

# Stripe Checkout URL (Cloudflare Worker endpoint for PWA checkout)
# This generates Stripe Checkout sessions for web payments
# Development: https://stripe-checkout.connect-2a2.workers.dev
# Production: Same endpoint (handles both test and live)
STRIPE_CHECKOUT_URL=https://stripe-checkout.connect-2a2.workers.dev

# Stripe Customer Portal URL (Cloudflare Worker for subscription management)
# Allows users to manage their subscription, update payment, cancel, etc.
# Development: https://customer-portal.connect-2a2.workers.dev
# Production: Same endpoint (handles both test and live)
STRIPE_CUSTOMER_PORTAL_URL=https://customer-portal.connect-2a2.workers.dev

# ============================================================================
# CODE VALIDATION API - Cloudflare Workers
# ============================================================================
#
# SECURITY REQUIREMENTS:
# 1. Use HTTPS only
# 2. Validate response format strictly
# 3. Use different URLs for dev/staging/production
# 4. Monitor for exposed URLs in logs
# 5. Endpoint is public but requires valid activation codes
#
# ENDPOINT DETAILS:
# - Validates activation codes from Stripe purchases
# - Marks codes as used with device ID tracking
# - Returns subscription tier and expiry information
# - No authentication required (codes are single-use)
#
# ROTATION SCHEDULE: N/A (stateless public endpoint)
# ============================================================================

# Code Validation Endpoint (Cloudflare Worker)
# Development: https://code-validation-api.connect-2a2.workers.dev
# Production: Same endpoint (handles both test and live codes)
CODE_VALIDATION_URL=https://code-validation-api.connect-2a2.workers.dev

# ============================================================================
# ACTIVEPIECES CONFIGURATION (DEPRECATED - Use Cloudflare Workers above)
# ============================================================================
#
# NOTE: Activepieces integration has been replaced with Cloudflare Workers
# for better performance, reliability, and simpler architecture.
# Keep these settings for reference but they are no longer used.
#
# ============================================================================

# DEPRECATED: Activepieces MCP Server URL (No longer used)
# ACTIVEPIECES_MCP_URL=https://cloud.activepieces.com/api/v1/projects/YOUR_PROJECT_ID/mcp-server/http

# DEPRECATED: Activepieces API Token (No longer used)
# ACTIVEPIECES_TOKEN=YOUR_ACTIVEPIECES_TOKEN_HERE

# DEPRECATED: Activepieces Flow Webhook URLs (No longer used)
# ACTIVEPIECES_MESSAGE_LIMIT_URL=https://cloud.activepieces.com/api/v1/webhooks/YOUR_MESSAGE_LIMIT_WEBHOOK
# ACTIVEPIECES_START_TRIAL_URL=https://cloud.activepieces.com/api/v1/webhooks/YOUR_START_TRIAL_WEBHOOK
# ACTIVEPIECES_STRIPE_WEBHOOK_URL=https://cloud.activepieces.com/api/v1/webhooks/YOUR_STRIPE_WEBHOOK
# ACTIVEPIECES_WEBHOOK_SECRET=YOUR_WEBHOOK_SIGNATURE_SECRET_HERE

# ============================================================================
# SECURITY HEADERS & CORS
# ============================================================================

# Allowed Origins (comma-separated, no spaces)
ALLOWED_ORIGINS=http://localhost:3000,https://yourdomain.com

# Enable CORS (true/false)
ENABLE_CORS=true

# ============================================================================
# MONITORING & LOGGING
# ============================================================================

# Sentry Error Tracking (Optional - for production monitoring)
SENTRY_DSN=https://YOUR_SENTRY_DSN_HERE
SENTRY_ENVIRONMENT=development

# Log Level (debug, info, warn, error)
LOG_LEVEL=info

# ============================================================================
# SECURITY CHECKLIST
# ============================================================================
# Before deploying to production:
# [ ] All keys are production keys (not test keys)
# [ ] APP_ENV=production
# [ ] STRIPE_RESTRICTED_KEY starts with rk_live_
# [ ] STRIPE_WEBHOOK_SECRET configured and verified
# [ ] ACTIVEPIECES_TOKEN is production token
# [ ] All webhook URLs use HTTPS
# [ ] ALLOWED_ORIGINS contains only production domains
# [ ] SENTRY_DSN configured for error tracking
# [ ] .env file is in .gitignore
# [ ] No test/development keys in production
# [ ] Key rotation dates documented
# [ ] Secrets manager configured (AWS Secrets Manager, etc.)
# ============================================================================
